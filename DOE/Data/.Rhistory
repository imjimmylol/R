temp_iter = c("15~20", "20~25", "25~30")
type_iter = c("drug", "rape", "robbey", "theft")
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in vax_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = mean(y)
cell_std = var(y)
}
}
}
marry_iter = c("4.5 ~ 5", "5 ~ 5.5", "5.5 ~ 6")
temp_iter = c("15~20", "20~25", "25~30")
type_iter = c("drug", "rape", "robbey", "theft")
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = mean(y)
cell_std = var(y)
}
}
}
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
crim_rate_test = function(df){
res = c()
uniq_dist = unique(df$district)
for(i in uniq_dist){
df_dist = df %>% filter(district==i)
num_of_crime = nrow(df_dist)
rate_of_crime = num_of_crime/(df_dist$popula[1])
res = append(res, rate_of_crime)
}
return(res*100)
}
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = mean(y)
cell_std = var(y)
}
}
}
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
crim_rate_test = function(df){
res = c()
uniq_dist = unique(df$district)
for(i in uniq_dist){
df_dist = df %>% filter(district==i)
num_of_crime = nrow(df_dist)
# rate_of_crime = num_of_crime/(df_dist$popula[1])
res = append(res, num_of_crime)
}
return(res)
}
marry_iter = c("4.5 ~ 5", "5 ~ 5.5", "5.5 ~ 6")
temp_iter = c("15~20", "20~25", "25~30")
type_iter = c("drug", "rape", "robbey", "theft")
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = mean(y)
cell_std = var(y)
}
}
}
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
print(y)
cell_mean = mean(y)
cell_std = var(y)
}
}
}
df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "drug")
test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "drug")
crim_rate(test)
y = crim_rate(test)
y
mean(y)
var(y)
test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
y = crim_rate(test)
y
mean(y)
var(y)
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(n_obs, mean(y))
cell_std = append(n_obs, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate_test(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
crim_rate = function(df){
res = c()
uniq_dist = unique(df$district)
for(i in uniq_dist){
df_dist = df %>% filter(district==i)
num_of_crime = nrow(df_dist)
rate_of_crime = num_of_crime/(df_dist$popula[1])
res = append(res, rate_of_crime)
}
return(res*100)
}
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
# my function####
magic = function(x){
y = str_sub(x, start = 1, end = 3) %>% parse_number() %>% as.numeric()
m = str_sub(x, start = 5, end = 8) %>% parse_number() %>% as.character()
return( paste(as.character(y+1911), m, sep = "-"))
}
d_trans = function(raw_d){
y = str_sub(raw_d, start = 1, end = 3) %>% as.numeric()
m = str_sub(raw_d, start = 4, end = 5)
d = str_sub(raw_d, start = 6, end = 7)
ymd = paste(as.character(y+1911), m, d, sep = "-")
return(ymd)
}
season_trans = function(ymd){
season = str_sub(ymd, start = 5, end = 6) %>% as.numeric()
if(season<4){
return("spring")
}
else if((season<=6) & (season>=4)){
return("summer")
}
else if((season<=9) & (season>6)){
return("autumn")
}
else{
return("winter")
}
}
crmin_trans = function(crime){
if(crime == "毒品"){
return("drug")
}
else if(crime == "機車竊盜"|crime == "汽車竊盜"|crime == "住宅竊盜"){
return("theft")
}
else if(crime == "強制性交"){
return("rape")
}
else{
return("robbery")
}
}
temp_trans = function(district, month){
col_index = which(names(df_temp_2000)==district)
row_index = month
return(df_temp_2000[row_index,col_index] %>% as.numeric())
}
popl_trans = function(district){
if(district == "臺北市"){
return(2602418)
}
else if(district == "高雄市"){
return(2765932)
}
else if(district == "新竹市"){
return(451412)
}
else if(district == "臺中市"){
return(2820787)
}
else if(district == "花蓮市"){
return(324372)
}
else if(district == "南投縣"){
return(490832)
}
else if(district == "苗栗縣"){
return(542590)
}
else if(district == "桃園市"){
return(2268807)
}
else if(district == "基隆市"){
return(367557)
}
else if(district == "新北市"){
return(2602418)
}
else if(district == "嘉義市"){
return(266005)
}
else if(district == "彰化縣"){
return(1266670)
}
else if(district == "臺南市 "){
return(1874917)
}
}
temp_dummy = function(temp){
if(temp<=20){
return("15~20")
}
else if(temp<=25&temp>20){
return("20~25")
}
else{
return("25~30")
}
}
crmin_trans = function(crime){
if(crime == "毒品"){
return("drug")
}
else if(crime == "機車竊盜"|crime == "汽車竊盜"|crime == "住宅竊盜"){
return("theft")
}
else if(crime == "強制性交"){
return("rape")
}
else{
return("robbey")
}
}
loca_trans = function(raw_loca){
return(str_sub(raw_loca, start = 1, end = 3))
}
temp_trans_test = function(district, month){
col_index = which(names(df_temp_2000)==district)
row_index = month
res = as.numeric(df_temp_2000[row_index,col_index])
return(res)
}
marry_trans = function(district){
if(district == "臺北市"){
return(4.83)
}
else if(district == "高雄市"){
return(5.04)
}
else if(district == "新竹市"){
return(5.34)
}
else if(district == "臺中市"){
return(5.5)
}
else if(district == "花蓮市"){
return(5.29)
}
else if(district == "南投縣"){
return(4.72)
}
else if(district == "苗栗縣"){
return(4.97)
}
else if(district == "桃園市"){
return(5.76)
}
else if(district == "基隆市"){
return(4.85)
}
else if(district == "新北市"){
return(5.27)
}
else if(district == "嘉義市"){
return(4.78)
}
else if(district == "彰化縣"){
return(4.74)
}
else if(district == "臺南市"){
return(4.96)
}
}
marry_rate_interval = function(marry_rate){
if(marry_rate<=4.5){
return("4 ~ 4.5")
}
else if(marry_rate>4.5&marry_rate<=5){
return("4.5 ~ 5")
}
else if(marry_rate>5&marry_rate<=5.5){
return("5 ~ 5.5")
}
else{
return("5.5 ~ 6")
}
}
crim_rate = function(df){
res = c()
uniq_dist = unique(df$district)
for(i in uniq_dist){
df_dist = df %>% filter(district==i)
num_of_crime = nrow(df_dist)
rate_of_crime = num_of_crime/(df_dist$popula[1])
res = append(res, rate_of_crime)
}
return(res)
}
crim_rate_test = function(df){
res = c()
uniq_dist = unique(df$district)
for(i in uniq_dist){
df_dist = df %>% filter(district==i)
num_of_crime = nrow(df_dist)
rate_of_crime = num_of_crime/(df_dist$popula[1])
res = append(res, rate_of_crime)
}
return(res*100)
}
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
n_obs =  c()
cell_mean = c()
cell_std = c()
for(k in marry_iter){
for(i in temp_iter){
for(j in type_iter){
df_iter = df %>% filter(marr_level == k) %>% filter(temp_level == i) %>% filter(type == j)
y = crim_rate(df_iter)
n_obs = append(n_obs, length(y))
cell_mean = append(cell_mean, mean(y))
cell_std = append(cell_std, var(y))
}
}
}
# test = df %>% filter(marr_level == "4.5 ~ 5") %>% filter(temp_level == "15~20") %>% filter(type == "rape")
coln = type_iter
rown = temp_iter
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[13:24]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(n_obs[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_mean[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
matrix(c(cell_std[1:12]), nrow  = 3, ncol = 4,byrow = TRUE,dimnames = list(rown, coln))
